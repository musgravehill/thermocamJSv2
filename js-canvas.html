<!DOCTYPE HTML>
<html>
    <head>        
        <meta charset="utf-8">
    </head>
    <body>

        <div id="block__view">
            <canvas id="thermalCanvasSys" width="64" height="48">Обновите браузер</canvas>
            <canvas id="thermalCanvas" width="640" height="480">Обновите браузер</canvas>
            <p id="minmax">
                MIN(T)=<span id="minT"></span>
                <br>
                MAX(T)=<span id="maxT"></span>
            </p>
            <p id="cursorData">T(cursor)=<span id="temperatureUnderCursor"></span></p>
        </div>
        <div id="block__control">
            <input type="file" id="fileinput" />
        </div>

        <style type="text/css">
            #thermalCanvasSys{
                width: 64px;
                height: 48px;
                display: none;
            }
            #thermalCanvas{
                width: 640px;
                height: 480px;
                border: 1px solid black;
                margin: 0;
                padding: 0;
            }
            #block__view{
                width: 642px;
                height: 482px;
                display: block;
                float: left;
                margin: 4px;
                padding: 0;
            }
            #cursorData{
                display: block;
                float: right;                
                margin: 4px;
                padding: 0;
                width: 150px;
            }
            #minmax{
                display: block;
                float: left;                
                margin: 4px;
                padding: 0;
            }
            #block__control{
                width: 400px;
                height: 300px;
                display: block;
                float: left;
                background-color: green;
                margin: 4px;
                padding: 0;
            }
        </style>


    </body>
    <script type="text/javascript">
        /*
         beginPath()
         closePath()
         stroke()
         fill()
         ----------------------------
         moveTo(x, y) // перемещает "курсор" в позицию x, y и делает её текущей
         lineTo(x, y) // ведёт линию из текущей позиции в указанную, и делает в последствии указанную текущей
         arc(x, y, radius, startAngle, endAngle, anticlockwise) // рисование дуги, где x и y центр окружности, далее начальный и конечный угол, последний параметр указывает направление

         fillStyle = color   // определяет цвет заливки
         strokeStyle = color // цвет линий цвет задается точно так же как и css, на примере все четыре способа задания цвета

         ctxSys.fillStyle = "orange";
         ctxSys.fillStyle = "#FFA500";
         ctxSys.fillStyle = "rgb(255,165,0)";
         ctxSys.fillStyle = "rgba(255,165,0,1)"

         rotate(rad)
         translate(x,y)
         scale(x,y)

         ctxSys.setTransform(m11, m12, m21, m22, dx, dy);

         Рассмотрим по очереди, за что отвечает каждый из аргументов.
         dx,  dy — повторяют метод translate, смещая картинку на соответствующие значения.
         m11, m22 — повторяют метод scale, изменяя размер отрысовываемых пикселей.
         m12, m21 — более интересные. Каждый пиксель (x,y) смещается на y*m21 пикселей вправо и на x*m12 пикселей вниз.
         Это значит, что при m21=1 каждая следующая строчка будет смещена на 1 пиксель вправо, относительно предыдущей.

         m11 = scaleX * cos(alpha),
         m12 = scaleY * sin(alpha),
         m21 = -scaleX * sin(alpha),
         m12 = scaleY * cos(alpha),
         где scaleX,scaleY — сжатие растяжение вдоль соответствующей оси, а alpha — угол поворота.

         */

        /* generated from /gradient/img-bry.png by PHP */
        var gradientMap = [[26, 17, 183], [10, 0, 177], [10, 0, 177], [10, 0, 177], [11, 0, 177], [12, 0, 176], [12, 0, 176], [12, 0, 177], [12, 0, 177], [12, 0, 176], [12, 0, 176], [13, 0, 175], [14, 0, 175], [14, 0, 175], [14, 0, 174], [14, 0, 174], [15, 0, 174], [16, 0, 174], [16, 0, 174], [16, 0, 173], [17, 0, 173], [17, 0, 173], [17, 0, 173], [17, 0, 172], [17, 0, 172], [18, 0, 172], [19, 0, 172], [19, 0, 172], [19, 0, 171], [19, 0, 171], [20, 0, 170], [21, 0, 170], [21, 0, 170], [21, 0, 170], [21, 0, 170], [22, 0, 169], [23, 0, 168], [23, 0, 169], [23, 0, 169], [24, 0, 168], [24, 0, 168], [25, 0, 167], [25, 0, 167], [25, 0, 167], [25, 0, 166], [27, 0, 166], [26, 0, 166], [27, 0, 166], [28, 0, 165], [28, 0, 165], [28, 0, 165], [28, 0, 164], [28, 0, 164], [29, 0, 164], [30, 0, 163], [31, 0, 163], [31, 0, 162], [32, 0, 162], [32, 0, 162], [32, 0, 161], [33, 0, 161], [33, 0, 160], [34, 0, 160], [34, 0, 160], [34, 0, 160], [35, 0, 159], [36, 0, 159], [37, 0, 159], [37, 0, 158], [37, 0, 158], [38, 0, 157], [38, 0, 157], [38, 0, 156], [39, 0, 156], [40, 0, 157], [40, 0, 156], [41, 0, 156], [41, 0, 156], [42, 0, 155], [43, 0, 155], [43, 0, 154], [44, 0, 153], [44, 0, 152], [44, 0, 152], [45, 0, 152], [46, 0, 152], [46, 0, 152], [46, 0, 152], [47, 0, 151], [48, 0, 150], [49, 0, 150], [49, 0, 150], [50, 0, 150], [50, 0, 149], [50, 0, 149], [51, 0, 148], [52, 0, 147], [52, 0, 147], [53, 0, 147], [54, 0, 147], [54, 0, 146], [55, 0, 145], [56, 0, 145], [56, 0, 145], [56, 0, 144], [56, 0, 144], [57, 0, 143], [58, 0, 143], [58, 0, 143], [59, 0, 142], [59, 0, 142], [60, 0, 141], [61, 0, 140], [61, 0, 140], [62, 0, 140], [63, 0, 140], [64, 0, 139], [64, 0, 138], [64, 0, 138], [65, 0, 138], [66, 0, 137], [67, 0, 137], [67, 0, 137], [67, 0, 136], [68, 0, 136], [69, 0, 135], [69, 0, 135], [69, 0, 135], [70, 0, 134], [71, 0, 134], [72, 0, 133], [72, 0, 133], [73, 0, 132], [74, 0, 131], [75, 0, 131], [75, 0, 130], [75, 0, 130], [76, 0, 130], [77, 0, 129], [78, 0, 129], [78, 0, 128], [79, 0, 128], [80, 0, 128], [80, 0, 127], [81, 0, 127], [81, 0, 126], [82, 0, 126], [83, 0, 126], [83, 0, 125], [83, 0, 124], [85, 0, 123], [86, 0, 123], [86, 0, 123], [86, 0, 122], [87, 0, 121], [88, 0, 121], [89, 0, 120], [89, 0, 120], [89, 0, 120], [90, 0, 120], [91, 0, 118], [92, 0, 118], [92, 0, 118], [93, 0, 118], [94, 0, 117], [95, 0, 116], [95, 0, 115], [96, 0, 115], [97, 0, 115], [97, 0, 115], [97, 0, 114], [98, 0, 113], [99, 0, 112], [99, 0, 112], [100, 0, 113], [101, 0, 112], [102, 0, 111], [103, 0, 110], [103, 0, 110], [104, 0, 110], [104, 0, 109], [105, 0, 109], [105, 0, 109], [107, 0, 108], [108, 0, 107], [108, 0, 107], [109, 0, 106], [109, 0, 105], [109, 0, 105], [110, 0, 105], [112, 0, 104], [112, 0, 103], [112, 0, 103], [113, 0, 103], [114, 0, 102], [115, 0, 102], [116, 0, 101], [117, 0, 100], [117, 0, 100], [117, 0, 100], [118, 0, 99], [119, 0, 98], [120, 0, 97], [120, 0, 97], [121, 0, 97], [122, 0, 97], [123, 0, 96], [123, 0, 95], [123, 0, 95], [124, 0, 95], [125, 0, 94], [126, 0, 94], [127, 0, 94], [127, 0, 93], [128, 0, 92], [129, 0, 92], [130, 0, 91], [131, 0, 90], [131, 0, 90], [131, 0, 90], [132, 0, 89], [133, 0, 89], [134, 0, 89], [134, 0, 88], [135, 0, 88], [135, 0, 87], [136, 0, 87], [137, 0, 87], [137, 0, 86], [137, 0, 86], [138, 0, 85], [139, 0, 84], [139, 0, 84], [139, 0, 84], [140, 0, 83], [141, 0, 82], [142, 0, 82], [142, 0, 82], [142, 0, 82], [143, 0, 81], [144, 0, 80], [145, 0, 80], [145, 0, 80], [145, 0, 80], [146, 0, 79], [147, 0, 78], [147, 0, 78], [147, 0, 78], [148, 0, 78], [149, 0, 77], [150, 0, 76], [150, 0, 76], [150, 0, 76], [151, 0, 75], [152, 0, 74], [152, 0, 74], [153, 0, 73], [154, 0, 73], [154, 0, 73], [155, 0, 73], [156, 0, 72], [156, 0, 72], [156, 0, 72], [157, 0, 71], [158, 0, 70], [159, 0, 70], [159, 0, 69], [160, 0, 69], [160, 0, 69], [160, 0, 69], [161, 0, 67], [162, 0, 67], [163, 0, 67], [163, 0, 67], [164, 0, 66], [164, 0, 66], [165, 0, 66], [166, 0, 66], [166, 0, 65], [167, 0, 64], [167, 0, 64], [168, 0, 64], [169, 0, 64], [169, 0, 63], [169, 0, 62], [170, 0, 61], [171, 0, 61], [172, 0, 61], [172, 0, 61], [172, 0, 60], [173, 0, 60], [173, 0, 59], [173, 0, 59], [174, 0, 59], [175, 0, 58], [175, 0, 58], [176, 0, 57], [177, 0, 56], [177, 0, 56], [177, 0, 56], [179, 0, 55], [179, 0, 55], [179, 0, 55], [180, 0, 54], [181, 0, 54], [181, 0, 53], [182, 0, 53], [183, 0, 53], [183, 0, 52], [183, 0, 52], [184, 0, 52], [185, 0, 51], [185, 0, 50], [185, 0, 50], [186, 0, 50], [187, 0, 50], [188, 0, 49], [188, 0, 48], [188, 0, 48], [189, 0, 48], [190, 0, 48], [190, 0, 47], [190, 0, 47], [191, 0, 47], [192, 0, 46], [192, 0, 46], [193, 0, 45], [194, 0, 45], [194, 0, 45], [194, 0, 44], [195, 0, 44], [195, 0, 43], [195, 0, 42], [196, 0, 42], [197, 0, 42], [197, 0, 41], [198, 0, 41], [198, 0, 41], [198, 0, 41], [199, 0, 40], [200, 0, 40], [201, 0, 40], [201, 0, 40], [201, 0, 39], [202, 0, 39], [202, 0, 38], [203, 0, 38], [204, 0, 38], [204, 0, 37], [205, 0, 37], [205, 0, 36], [206, 0, 35], [206, 0, 36], [206, 0, 36], [207, 0, 35], [208, 0, 34], [208, 0, 34], [208, 0, 34], [209, 0, 33], [210, 0, 33], [210, 0, 33], [211, 0, 32], [211, 0, 32], [211, 0, 32], [212, 0, 31], [213, 0, 31], [213, 0, 30], [214, 0, 30], [214, 0, 30], [214, 0, 30], [215, 0, 29], [216, 0, 29], [216, 0, 29], [216, 0, 28], [217, 0, 28], [217, 0, 27], [217, 0, 27], [217, 0, 27], [218, 0, 27], [219, 0, 26], [220, 0, 26], [220, 0, 26], [221, 0, 26], [221, 0, 25], [221, 0, 25], [222, 0, 24], [222, 0, 24], [222, 0, 24], [223, 0, 23], [224, 0, 23], [224, 0, 22], [224, 0, 22], [224, 0, 22], [225, 0, 22], [226, 0, 21], [226, 0, 21], [226, 0, 20], [226, 0, 20], [227, 0, 20], [228, 0, 20], [229, 0, 19], [229, 0, 19], [230, 0, 19], [230, 0, 19], [229, 0, 18], [230, 0, 18], [230, 0, 18], [231, 0, 18], [232, 0, 17], [232, 0, 16], [233, 0, 16], [233, 0, 16], [234, 0, 16], [234, 0, 16], [234, 0, 16], [234, 0, 15], [235, 0, 14], [235, 0, 14], [235, 0, 14], [236, 0, 14], [236, 0, 13], [237, 0, 13], [237, 0, 13], [237, 0, 13], [238, 0, 13], [239, 0, 12], [239, 0, 12], [239, 0, 12], [239, 0, 12], [240, 0, 11], [240, 0, 11], [241, 0, 10], [241, 0, 11], [241, 0, 11], [242, 0, 10], [242, 0, 9], [243, 0, 10], [243, 0, 10], [242, 0, 9], [243, 0, 9], [243, 0, 8], [244, 0, 8], [244, 0, 8], [244, 0, 8], [245, 0, 7], [245, 0, 7], [245, 0, 7], [245, 0, 7], [246, 0, 6], [247, 0, 6], [247, 0, 6], [247, 0, 6], [247, 0, 6], [247, 0, 6], [248, 0, 5], [248, 0, 5], [248, 0, 4], [249, 0, 5], [249, 0, 5], [249, 0, 4], [250, 0, 4], [250, 0, 4], [251, 0, 4], [251, 0, 3], [251, 0, 3], [252, 0, 3], [251, 0, 2], [251, 0, 2], [252, 0, 2], [252, 0, 2], [253, 0, 2], [253, 0, 2], [253, 0, 2], [253, 0, 1], [253, 0, 1], [254, 0, 0], [254, 0, 1], [255, 0, 1], [255, 0, 1], [255, 0, 0], [255, 0, 0], [255, 0, 0], [255, 0, 0], [255, 0, 0], [255, 1, 0], [255, 1, 0], [255, 1, 0], [255, 1, 0], [255, 1, 0], [255, 2, 0], [255, 2, 0], [255, 2, 0], [255, 3, 0], [255, 3, 0], [255, 2, 0], [255, 3, 0], [255, 3, 0], [255, 4, 0], [255, 4, 0], [255, 4, 0], [255, 4, 0], [255, 5, 0], [255, 5, 0], [255, 5, 0], [255, 5, 0], [255, 5, 0], [255, 5, 0], [255, 6, 0], [255, 6, 0], [255, 6, 0], [255, 7, 0], [255, 6, 0], [255, 6, 0], [255, 7, 0], [255, 7, 0], [255, 7, 0], [255, 8, 0], [255, 9, 0], [255, 9, 0], [255, 8, 0], [255, 9, 0], [255, 9, 0], [255, 9, 0], [255, 9, 0], [255, 10, 0], [255, 10, 0], [255, 10, 0], [255, 11, 0], [255, 11, 0], [255, 11, 0], [255, 12, 0], [255, 12, 0], [255, 12, 0], [255, 12, 0], [255, 12, 0], [255, 13, 0], [255, 14, 0], [255, 14, 0], [255, 14, 0], [255, 14, 0], [255, 15, 0], [255, 14, 0], [255, 14, 0], [255, 15, 0], [255, 15, 0], [255, 16, 0], [255, 16, 0], [255, 16, 0], [255, 16, 0], [255, 17, 0], [255, 17, 0], [255, 18, 0], [255, 18, 0], [255, 18, 0], [255, 18, 0], [255, 19, 0], [255, 20, 0], [255, 20, 0], [255, 20, 0], [255, 20, 0], [255, 20, 0], [255, 21, 0], [255, 21, 0], [255, 21, 0], [255, 22, 0], [255, 22, 0], [255, 22, 0], [255, 22, 0], [255, 22, 0], [255, 23, 0], [255, 24, 0], [255, 24, 0], [255, 24, 0], [255, 24, 0], [255, 24, 0], [255, 25, 0], [255, 25, 0], [255, 25, 0], [255, 26, 0], [255, 27, 0], [255, 26, 0], [255, 27, 0], [255, 27, 0], [255, 27, 0], [255, 28, 0], [255, 28, 0], [255, 29, 0], [255, 29, 0], [255, 29, 0], [255, 29, 0], [255, 31, 0], [255, 31, 0], [255, 31, 0], [255, 31, 0], [255, 32, 0], [255, 32, 0], [255, 32, 0], [255, 32, 0], [255, 33, 0], [255, 34, 0], [255, 33, 0], [255, 34, 0], [255, 34, 0], [255, 34, 0], [255, 35, 0], [255, 35, 0], [255, 36, 0], [255, 36, 0], [255, 36, 0], [255, 37, 0], [255, 38, 0], [255, 38, 0], [255, 38, 0], [255, 38, 0], [255, 39, 0], [255, 39, 0], [255, 40, 0], [255, 40, 0], [255, 40, 0], [255, 40, 0], [255, 41, 0], [255, 42, 0], [255, 42, 0], [255, 42, 0], [255, 43, 0], [255, 42, 0], [255, 43, 0], [255, 44, 0], [255, 44, 0], [255, 44, 0], [255, 45, 0], [255, 45, 0], [255, 45, 0], [255, 46, 0], [255, 47, 0], [255, 46, 0], [255, 47, 0], [255, 48, 0], [255, 48, 0], [255, 48, 0], [255, 49, 0], [255, 49, 0], [255, 50, 0], [255, 50, 0], [255, 50, 0], [255, 51, 0], [255, 51, 0], [255, 52, 0], [255, 52, 0], [255, 52, 0], [255, 53, 0], [255, 54, 0], [255, 54, 0], [255, 54, 0], [255, 55, 0], [255, 55, 0], [255, 55, 0], [255, 56, 0], [255, 56, 0], [255, 56, 0], [255, 57, 0], [255, 58, 0], [255, 58, 0], [255, 58, 0], [255, 59, 0], [255, 59, 0], [255, 60, 0], [255, 60, 0], [255, 60, 0], [255, 60, 0], [255, 61, 0], [255, 61, 0], [255, 61, 0], [255, 62, 0], [255, 63, 0], [255, 64, 0], [255, 64, 0], [255, 64, 0], [255, 64, 0], [255, 65, 0], [255, 66, 0], [255, 66, 0], [255, 67, 0], [255, 67, 0], [255, 67, 0], [255, 67, 0], [255, 68, 0], [255, 69, 0], [255, 69, 0], [255, 69, 0], [255, 69, 0], [255, 70, 0], [255, 71, 0], [255, 71, 0], [255, 72, 0], [255, 72, 0], [255, 72, 0], [255, 72, 0], [255, 73, 0], [255, 74, 0], [255, 74, 0], [255, 75, 0], [255, 75, 0], [255, 75, 0], [255, 75, 0], [255, 77, 0], [255, 77, 0], [255, 78, 0], [255, 78, 0], [255, 78, 0], [255, 78, 0], [255, 79, 0], [255, 80, 0], [255, 80, 0], [255, 80, 0], [255, 80, 0], [255, 81, 0], [255, 82, 0], [255, 82, 0], [255, 82, 0], [255, 83, 0], [255, 84, 0], [255, 84, 0], [255, 84, 0], [255, 84, 0], [255, 85, 0], [255, 86, 0], [255, 86, 0], [255, 86, 0], [255, 87, 0], [255, 87, 0], [255, 88, 0], [255, 89, 0], [255, 89, 0], [255, 90, 0], [255, 90, 0], [255, 91, 0], [255, 91, 0], [255, 91, 0], [255, 91, 0], [255, 92, 0], [255, 93, 0], [255, 93, 0], [255, 93, 0], [255, 94, 0], [255, 95, 0], [255, 96, 0], [255, 96, 0], [255, 96, 0], [255, 96, 0], [255, 96, 0], [255, 97, 0], [255, 98, 0], [255, 98, 0], [255, 99, 0], [255, 100, 0], [255, 99, 0], [255, 100, 0], [255, 101, 0], [255, 101, 0], [255, 101, 0], [255, 102, 0], [255, 103, 0], [255, 103, 0], [255, 103, 0], [255, 104, 0], [255, 105, 0], [255, 105, 0], [255, 105, 0], [255, 106, 0], [255, 106, 0], [255, 106, 0], [255, 107, 0], [255, 108, 0], [255, 108, 0], [255, 108, 0], [255, 109, 0], [255, 110, 0], [255, 110, 0], [255, 110, 0], [255, 110, 0], [255, 111, 0], [255, 112, 0], [255, 112, 0], [255, 113, 0], [255, 113, 0], [255, 114, 0], [255, 115, 0], [255, 115, 0], [255, 115, 0], [255, 115, 0], [255, 116, 0], [255, 117, 0], [255, 117, 0], [255, 118, 0], [255, 117, 0], [255, 118, 0], [255, 120, 0], [255, 120, 0], [255, 120, 0], [255, 120, 0], [255, 121, 0], [255, 121, 0], [255, 121, 0], [255, 122, 0], [255, 123, 0], [255, 123, 0], [255, 123, 0], [255, 124, 0], [255, 125, 0], [255, 125, 0], [255, 126, 0], [255, 126, 0], [255, 127, 0], [255, 128, 0], [255, 128, 0], [255, 129, 0], [255, 130, 0], [255, 131, 0], [255, 132, 0], [255, 133, 0], [255, 133, 0], [255, 134, 0], [255, 135, 0], [255, 136, 0], [255, 137, 0], [255, 138, 0], [255, 139, 0], [255, 139, 0], [255, 140, 0], [255, 141, 0], [255, 142, 0], [255, 143, 0], [255, 143, 0], [255, 144, 0], [255, 145, 0], [255, 146, 0], [255, 146, 0], [255, 148, 0], [255, 149, 0], [255, 149, 0], [255, 150, 0], [255, 152, 0], [255, 152, 0], [255, 153, 0], [255, 154, 0], [255, 155, 0], [255, 156, 0], [255, 156, 0], [255, 157, 0], [255, 158, 0], [255, 158, 0], [255, 159, 0], [255, 160, 0], [255, 161, 0], [255, 162, 0], [255, 163, 0], [255, 163, 0], [255, 163, 0], [255, 165, 0], [255, 167, 0], [255, 167, 0], [255, 167, 0], [255, 168, 0], [255, 169, 0], [255, 170, 0], [255, 171, 0], [255, 171, 0], [255, 171, 0], [255, 172, 0], [255, 174, 0], [255, 175, 0], [255, 176, 0], [255, 176, 0], [255, 177, 0], [255, 178, 0], [255, 179, 0], [255, 180, 0], [255, 180, 0], [255, 181, 0], [255, 182, 0], [255, 183, 0], [255, 184, 0], [255, 184, 0], [255, 185, 0], [255, 185, 0], [255, 186, 0], [255, 187, 0], [255, 188, 0], [255, 189, 0], [255, 189, 0], [255, 190, 0], [255, 192, 0], [255, 192, 0], [255, 193, 0], [255, 193, 0], [255, 194, 0], [255, 195, 0], [255, 195, 0], [255, 196, 0], [255, 197, 0], [255, 198, 0], [255, 198, 0], [255, 199, 0], [255, 200, 0], [255, 201, 0], [255, 201, 0], [255, 201, 0], [255, 202, 0], [255, 203, 0], [255, 204, 0], [255, 205, 0], [255, 206, 0], [255, 206, 0], [255, 207, 0], [255, 208, 0], [255, 208, 0], [255, 208, 0], [255, 209, 0], [255, 210, 0], [255, 211, 0], [255, 211, 0], [255, 212, 0], [255, 213, 0], [255, 213, 0], [255, 215, 0], [255, 215, 0], [255, 215, 0], [255, 216, 0], [255, 217, 0], [255, 218, 0], [255, 218, 0], [255, 218, 0], [255, 219, 0], [255, 220, 0], [255, 221, 0], [255, 222, 0], [255, 222, 0], [255, 222, 0], [255, 223, 0], [255, 224, 0], [255, 224, 0], [255, 224, 0], [255, 226, 0], [255, 227, 0], [255, 227, 0], [255, 228, 0], [255, 229, 0], [255, 229, 0], [255, 229, 0], [255, 230, 0], [255, 230, 0], [255, 231, 0], [255, 231, 0], [255, 231, 0], [255, 233, 0], [255, 233, 0], [255, 234, 0], [255, 234, 0], [255, 234, 0], [255, 235, 0], [255, 236, 0], [255, 236, 0], [255, 236, 0], [255, 237, 0], [255, 237, 0], [255, 238, 0], [255, 239, 0], [255, 239, 0], [255, 240, 0], [255, 240, 0], [255, 240, 0], [255, 240, 0], [255, 241, 0], [255, 242, 0], [255, 243, 0], [255, 243, 0], [255, 244, 0], [255, 244, 0], [255, 244, 0], [255, 245, 0], [255, 245, 0], [255, 245, 0], [255, 246, 0], [255, 247, 0], [255, 247, 0], [255, 247, 0], [255, 247, 0], [255, 248, 0], [255, 249, 0], [255, 249, 0], [255, 249, 0], [255, 250, 0], [255, 250, 0], [255, 250, 0], [255, 251, 0], [255, 251, 0], [255, 252, 0], [255, 252, 0], [255, 252, 17]];

        var canvasT = new Array(64);
        for (var i = 0; i < 64; i++) {
            canvasT[i] = new Array(48);
        }
        var dataT = [];   //array of float_temperatures (make from file) 0..3071          
        var minT = 0; //minimal Temperature in array
        var maxT = 0; //max Temperature in array
        var arrayTemperatureMaxPos = 64 * 48 - 1; //0..3071
        var oneStep = 0; //T step on colors-array-size
        var scaleH = 10;
        var scaleV = 10;
        var thermalCanvasSys = document.getElementById("thermalCanvasSys");
        var thermalCanvas = document.getElementById("thermalCanvas");
        var ctxSys = thermalCanvasSys.getContext('2d');
        var ctx = thermalCanvas.getContext('2d');

        document.getElementById('fileinput').addEventListener('change', readDataTemperatureFile, false);
        function readDataTemperatureFile(evt) {
            var f = evt.target.files[0];
            if (f) {
                var fr = new FileReader();
                fr.onload = function(e) {
                    makeArrayTemperatureByFile(e);
                    minT = Math.min.apply(Math, dataT);
                    maxT = Math.max.apply(Math, dataT);
                    oneStep = (maxT - minT) / gradientMap.length;
                    drawThermalImage();
                    initCanvasEvents();
                }
                fr.readAsText(f);
            } else {
                alert("Failed to load file");
            }
        }
        function makeArrayTemperatureByFile(e) {
            dataT = e.target.result.split('\n');
            dataT.splice((arrayTemperatureMaxPos + 1), 20);//unset 25,thermal,r64,l48 and other rotten
        }
        function drawThermalImage() {
            ctxSys.mozImageSmoothingEnabled = true;
            ctxSys.msImageSmoothingEnabled = true;
            ctxSys.imageSmoothingEnabled = true;
            //ctxSys.globalCompositeOperation = "saturation";

            ctxSys.clearRect(0, 0, thermalCanvasSys.width, thermalCanvasSys.height);
            var imageData = ctxSys.createImageData(64, 48);

            var imageDataArray = [];
            for (var row = 47; row >= 0; row--) { // inverted, cause Canvas draw top-bottom. But thermocam scan bottom-top
                for (var col = 0; col < 64; col++) {
                    var i = row + col * 48;
                    var T = parseFloat(dataT[i]);
                    var colorRGB = T2Color(T);

                    imageDataArray.push(colorRGB[0]);
                    imageDataArray.push(colorRGB[1]);
                    imageDataArray.push(colorRGB[2]);
                    imageDataArray.push(255);

                    // inverted, cause Canvas draw top-bottom. But thermocam scan bottom-top
                    canvasT[col][(47 - row)] = T;
                }
            }
            imageData.data.set(imageDataArray);
            ctxSys.putImageData(imageData, 0, 0, 0, 0, 64, 48);

            ctx.drawImage(thermalCanvasSys, 0, 0, 640, 480);

        }


        function T2Color(T) {
            var pos = Math.round((T - minT) / oneStep) - 1;  // 0 ...1000
            if (pos < 0) {
                pos = 0;
            }
            if (pos > (gradientMap.length - 1)) {
                pos = gradientMap.length - 1;
            }
            return gradientMap[pos];
        }

        function initCanvasEvents() {

            document.getElementById('maxT').innerHTML = maxT;
            document.getElementById('minT').innerHTML = minT;

            thermalCanvas.removeEventListener('click');
            thermalCanvas.removeEventListener('mousemove');
            thermalCanvas.addEventListener('click', function(evt) {
                var x = evt.layerX;
                var y = evt.layerY;
                var messageX = x - 5;
                var messageY = y + 10;
                var cursorT = getTUnderCursor(x, y);
                var message = '* ' + cursorT;
                pinTemperatureByPixelClick(messageX, messageY, message);
            }, false);

            thermalCanvas.addEventListener('mousemove', function(evt) {
                var x = evt.layerX;
                var y = evt.layerY;
                var cursorT = getTUnderCursor(x, y);
                var message = cursorT;
                document.getElementById('temperatureUnderCursor').innerHTML = message;
            }, false);
        }

        function getTUnderCursor(x, y) {
            x -= scaleH / 2;
            y -= scaleV / 2;
            var col = Math.round(x / scaleH);
            var row = Math.round(y / scaleV);
            col = (col > 63) ? 63 : col;
            col = (col < 0) ? 0 : col;
            row = (row > 47) ? 47 : row;
            row = (row < 0) ? 0 : row;
            T = canvasT[col][row];
            return T;
        }

        function pinTemperatureByPixelClick(x, y, message) {
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.shadowBlur = 3;
            ctx.shadowColor = "black";
            ctx.font = '14pt Arial';
            ctx.fillStyle = 'white';
            ctx.fillText(message, x, y);
        }



    </script>    
</html>